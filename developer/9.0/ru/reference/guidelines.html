<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="Русский">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <title>Соглашение об оформлении кода в Odoo &mdash; Перевод на русский язык документации Odoo 9.0</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/patchqueue.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <script type="text/javascript" src="https://yastatic.net/es5-shims/0.0.2/es5-shims.min.js"></script>
    <script type="text/javascript" src="https://yastatic.net/share2/share.js"></script>
    <link rel="top" title="Перевод на русский язык документации Odoo 9.0" href="../index.html" />
    <link rel="up" title="Справочные материалы" href="../reference.html" />
    <link rel="next" title="API обновления" href="upgrade_api.html" />
    <link rel="prev" title="Бизнес-процессы" href="workflows.html" /> 
  </head>
  <body role="document"><header class="o_main_header o_has_sub_nav o_inverted ">
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <ul class="o_primary_nav">
        <li><a href="/">Документация</a></li>
      </ul>
    </div>
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Меню
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              
              





    
        
            <li><a href="../index.html">Документация  (9.0)</a></li>
        
    
    <li class="active"><a href="#">Соглашение об оформлении кода в Odoo</a></li>

              
          </ol>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
             

<li class="languages dropdown">
    <a class="dropdown-toggle" href="#" data-toggle="dropdown">
        Русский
    </a>
    <ul class="dropdown-menu" role="menu">
        
            <li><a href="/developer/9.0/en/reference/guidelines.html">English</a></li>
        
    </ul>
</li>



<li class="versions dropdown">
    <a class="dropdown-toggle" href="#" data-toggle="dropdown">
        9.0
    </a>
    <ul class="dropdown-menu" role="menu">
        
            <li><a href="/developer/8.0/ru/reference/guidelines.html">8.0</a></li>
        
            <li><a href="/developer/10.0/ru/reference/guidelines.html">10.0</a></li>
        
            <li><a href="/developer/11.0/ru/reference/guidelines.html">11.0</a></li>
        
    </ul>
</li>

            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            
              <li class="divider"></li>
            

            
            

<li><a href="/user/9.0/ru/">Пользователю</a></li>
<li><a href="/developer/9.0/ru/">Разработчику</a></li>
<li><a href="/developer/9.0/ru/api_integration.html">API</a></li>
<li><a href="/developer/9.0/ru/setup/install.html">Установка</a></li>
            

            
              <li class="divider"></li>
            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/odoo_guideline.jpg');"></span>
      <div class="container text-center">
        <h1> Соглашение об оформлении кода в Odoo - Odoo 9.0 </h1>
      </div>
    </figure>
    
    
    
    <div class="container ">
      <main class="container-fluid ">
        
        <div class="row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="list-group text-left nav"><li class="list-group-item"><a href="#module-structure" class="ripple internal reference">Структура модуля</a><ul ><li class="list-group-item"><a href="#directories" class="ripple internal reference">Каталоги</a></li><li class="list-group-item"><a href="#file-naming" class="ripple internal reference">Наименование файлов</a></li></ul></li><li class="list-group-item"><a href="#xml-files" class="ripple internal reference">XML файлы</a><ul ><li class="list-group-item"><a href="#format" class="ripple internal reference">Формат</a></li><li class="list-group-item"><a href="#naming-xml-id" class="ripple internal reference">Формирование имен xml_id</a><ul ><li class="list-group-item"><a href="#security-view-and-action" class="ripple internal reference">Безопасность, Представление и Действие</a></li><li class="list-group-item"><a href="#inherited-xml" class="ripple internal reference">Унаследованный XML-файл</a></li></ul></li></ul></li><li class="list-group-item"><a href="#python" class="ripple internal reference">Python</a><ul ><li class="list-group-item"><a href="#pep8-options" class="ripple internal reference">Параметры PEP8</a></li><li class="list-group-item"><a href="#imports" class="ripple internal reference">Импорт</a></li><li class="list-group-item"><a href="#idiomatics-python-programming" class="ripple internal reference">Программирование на идиотском языке Python</a></li><li class="list-group-item"><a href="#programming-in-odoo" class="ripple internal reference">Программирование в Odoo</a><ul ><li class="list-group-item"><a href="#make-your-method-works-in-batch" class="ripple internal reference">Сделайте ваш метод работает в пакетном режиме</a></li><li class="list-group-item"><a href="#propagate-the-context" class="ripple internal reference">Распространение контекста</a></li><li class="list-group-item"><a href="#do-not-bypass-the-orm" class="ripple internal reference">Не обходите ORM</a></li><li class="list-group-item"><a href="#no-sql-injections-please" class="ripple internal reference">Никаких инъекций SQL, пожалуйста!</a></li><li class="list-group-item"><a href="#keep-your-methods-short-simple-when-possible" class="ripple internal reference">Держите свои методы короткими / простыми, когда это возможно</a></li><li class="list-group-item"><a href="#never-commit-the-transaction" class="ripple internal reference">Никогда не совершать транзакции</a></li><li class="list-group-item"><a href="#use-translation-method-correctly" class="ripple internal reference">Правильно используйте метод перевода</a></li></ul></li><li class="list-group-item"><a href="#symbols-and-conventions" class="ripple internal reference">Символы и обозначения</a></li></ul></li><li class="list-group-item"><a href="#javascript-and-css" class="ripple internal reference">Javascript и CSS</a></li><li class="list-group-item"><a href="#git" class="ripple internal reference">Git</a><ul ><li class="list-group-item"><a href="#commit-message" class="ripple internal reference">Коммиты</a></li></ul></li></ul>
              
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/9.0/doc/reference/guidelines.rst" class="gith-link" target="_blank">
                  Оригинал на GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            <div class="ya-share2" data-services="collections,vkontakte,facebook,odnoklassniki,moimir,gplus,twitter,linkedin,viber,whatsapp,skype,telegram"></div>
            
            
  <section id="odoo-guidelines"><p >На этой странице представлены новые правила кодирования Оду. Они направлены на улучшение качества кода (например, улучшение читаемости исходного кода) и приложений Odoo. Действительно, правильный код облегчает обслуживание, помогает в отладке, снижает сложность и повышает надежность.</p><p >Эти рекомендации должны применяться ко всем новым модулям и новым разработкам. Эти рекомендации будут применяться только к старому модулю ** ** в случае рефакторинга кода (переход на новый API, большой рефакторинг, ...).</p><div role="alert" class="alert-warning alert"><p class="alert-title">Предупреждение</p><p >Эти рекомендации написаны с учетом новых модулей и новых файлов. При изменении существующих файлов исходный стиль файла строго заменяет любые другие правила стиля. Другими словами, никогда не изменяйте существующие файлы, чтобы применять эти рекомендации, чтобы не нарушать историю изменений каждой строки. Для получения дополнительной информации см. Наше руководство по запросу pull &lt;<a href="https://odoo.com/submit-pr" class="external reference alert-link">https://odoo.com/submit-pr</a>&gt; [UNKNOWN NODE problematic]_.</p></div></section><section id="module-structure"><h2 >Структура модуля</h2></section><section id="directories"><h3 >Каталоги</h3><p >Модуль организован в важных каталогах. Они содержат бизнес-логику; Взглянув на них, следует понять цель модуля.</p><ul ><li ><p ><em >data/</em> : демо-данные и файлы данных xml</p></li><li ><p ><em >models/</em> : здесь определяются модели данных</p></li><li ><em >controllers/</em> : contains controllers (HTTP routes).</li><li ><p ><em >views/</em> : содержит представления и шаблоны</p></li><li ><p ><em >static/</em> : содержит веб компоненты, подразделяется на подкаталоги по содержимому <em >css/, js/, img/, lib/, ...</em></p></li></ul><p >Модуль содержит дополнительные необязательные каталоги.</p><ul ><li ><em >wizard/</em> : regroups the transient models (formerly <em >osv_memory</em>) and their views.</li><li ><em >report/</em> : contains the reports (RML report <strong >[deprecated]</strong>, models based on SQL views (for reporting) and other complex reports). Python objects and XML views are included in this directory.</li><li ><em >tests/</em> : contains the Python/YML tests</li></ul></section><section id="file-naming"><h3 >Наименование файлов</h3><p >Для объявления <em >представлений</em> для бэкэнда и фронтэнда, разделите их на два разных файла</p><p >Для <em >моделей данных</em>, разделите бизнес-логику на несколько наборов моделей данных, в каждом наборе выберите основную модель, она даст свое имя набору. Если есть только одна модель данных, то ее имя будет являться именем модуля. Для каждого набора с именем &lt;main_model&gt; могут быть созданы следующие файлы:</p><ul ><li ><code class="file">models/<em >&lt;main_model&gt;</em>.py</code></li><li ><code class="file">models/<em >&lt;inherited_main_model&gt;</em>.py</code></li><li ><code class="file">views/<em >&lt;main_model&gt;</em>_templates.xml</code></li><li ><code class="file">views/<em >&lt;main_model&gt;</em>_views.xml</code></li></ul><p >Например, модуль <em >sale</em> объявляет модели данных <code >sale_order</code> и <code >sale_order_line</code>, где доминирует <code >sale_order</code>. Таким образом, файлы <code >&lt;main_model&gt;</code> будут называться: <code class="file">models/sale_order.py</code> и <code class="file">views/sale_order_views.py</code>.</p><p >Для <em >data</em> разделите их по видам: демо или служебные данные. Имя файла будет именем main_model, с суффиксом <em >_demo.xml</em> или <em >_data.xml</em>.</p><p >Для <em >контроллеров</em>, единственный файл должен называться <em >main.py</em>. В противном случае, если вам нужно наследовать существующий контроллер от другого модуля, его имя будет <em >&lt;module_name&gt;.py</em>. В отличие от <em >моделей</em>, каждый класс контроллера должен содержаться в отдельном файле.</p><p >Для <em >статических файлов</em>, поскольку ресурсы могут использоваться в разных контекстах (frontend, backend или оба), они будут включены только в один пакет. Таким образом, CSS/Less, JavaScript и XML-файлы должны быть дополнены именем типа пакета. Т.е.: <em >im_chat_common.css</em>, <em >im_chat_common.js</em> для комплекта «assets_common» и <em >im_chat_backend.css</em>, <em >im_chat_backend.js</em> для пакета «assets_backend». Если модулю принадлежит только один файл, его имя будет <em >&lt;имя_модуля&gt;.ext</em> (т.е. <em >project.js</em>). Не ссылайтесь на данные (изображения, библиотеки) за пределами Odoo: не используйте ссылки на изображения - копируйте изображения в соотвествующий каталог.</p><p >Что касается <em >данных</em>, разделите их по целям: данные или демо. Имя будет начинаться <em >main_model</em>, а заканчиваться суффиксом <em >_data.xml</em> или <em >_demo.xml</em>.</p><p >Что касается <em >мастеров</em>, имена должны быть такими:</p><ul ><li ><code class="file"><em >&lt;main_transient&gt;</em>.py</code></li><li ><code class="file"><em >&lt;main_transient&gt;</em>_views.xml</code></li></ul><p >Где <em >&lt;main_transient&gt;</em> - имя доминирующей модели переходных процессов, как и для <em >моделей данных</em>. &lt;main_transient&gt;.py содержит модели 'model.action' и 'model.action.line'.</p><p >Имена <em >статистических отчетов</em> должны выглядеть так:</p><ul ><li ><code class="file"><em >&lt;report_name_A&gt;</em>_report.py</code></li><li ><p ><code class="file"><em >&lt;report_name_A&gt;</em>_report_views.py</code> (часто сводные и графические представления)</p></li></ul><p >Имена <em >отчетов для печати</em> должны быть такими:</p><ul ><li ><p ><code class="file"><em >&lt;print_report_name&gt;</em>_reports.py</code> (действия с отчетами, определение формата бумаги, ...)</p></li><li ><p ><code class="file"><em >&lt;print_report_name&gt;</em>_templates.xml</code> (шаблоны отчетов xml)</p></li></ul><p >Полное дерево каталогов должно выглядеть следующим образом:</p><div class="highlight-text"><div class="highlight"><pre><span></span>addons/&lt;my_module_name&gt;/
|-- __init__.py
|-- __openerp__.py
|-- controllers/
|   |-- __init__.py
|   |-- &lt;inherited_module_name&gt;.py
|   `-- main.py
|-- data/
|   |-- &lt;main_model&gt;_data.xml
|   `-- &lt;inherited_main_model&gt;_demo.xml
|-- models/
|   |-- __init__.py
|   |-- &lt;main_model&gt;.py
|   `-- &lt;inherited_main_model&gt;.py
|-- report/
|   |-- __init__.py
|   |-- &lt;main_stat_report_model&gt;.py
|   |-- &lt;main_stat_report_model&gt;_views.xml
|   |-- &lt;main_print_report&gt;_reports.xml
|   `-- &lt;main_print_report&gt;_templates.xml
|-- security/
|   |-- ir.model.access.csv
|   `-- &lt;main_model&gt;_security.xml
|-- static/
|   |-- img/
|   |   |-- my_little_kitten.png
|   |   `-- troll.jpg
|   |-- lib/
|   |   `-- external_lib/
|   `-- src/
|       |-- js/
|       |   `-- &lt;my_module_name&gt;.js
|       |-- css/
|       |   `-- &lt;my_module_name&gt;.css
|       |-- less/
|       |   `-- &lt;my_module_name&gt;.less
|       `-- xml/
|           `-- &lt;my_module_name&gt;.xml
|-- views/
|   |-- &lt;main_model&gt;_templates.xml
|   |-- &lt;main_model&gt;_views.xml
|   |-- &lt;inherited_main_model&gt;_templates.xml
|   `-- &lt;inherited_main_model&gt;_views.xml
`-- wizard/
    |-- &lt;main_transient_A&gt;.py
    |-- &lt;main_transient_A&gt;_views.xml
    |-- &lt;main_transient_B&gt;.py
    `-- &lt;main_transient_B&gt;_views.xml
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Примечание</p><p >Имена файлов должны содержать только <code >[a-z0-9_]</code> (строчные буквы, цифры и <code >_</code>)</p></div><div role="alert" class="alert-warning alert"><p class="alert-title">Предупреждение</p><p >Используйте правильные разрешения для файлов: для каталогов - 755, файлов - 644.</p></div></section><section id="xml-files"><h2 >XML файлы</h2></section><section id="format"><h3 >Формат</h3><p >Чтобы объявить запись в XML, рекомендуется использовать запись <strong >record</strong> (с использованием <em >&lt;record&gt;</em>):</p><ul ><li ><p >Поставьте атрибут <code >id</code> перед атрибутом <code >model</code></p></li><li ><p >При объявления поля первым ставиться атрибут <code >name</code>. Затем поместите <em >значение</em> поля в тег <code >field</code> затем атрибут <code >eval</code> и, наконец, другие атрибуты (widget, options, ...), следующие в порядке важности.</p></li><li ><p >Попробуйте сгруппировать записи по модели. В случае зависимостей между действием / меню / видами это соглашение может быть неприменимым.</p></li><li ><p >Использовать соглашение об создании имен, определенное далее</p></li><li ><p >Тег [UNKNOWN NODE problematic]&lt;data&gt; * используется только для установки не-обновляемых данных с помощью параметра <code >noupdate=1</code></p></li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;view_id&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>view.name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>object_name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;priority&quot;</span> <span class="na">eval=</span><span class="s">&quot;16&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tree&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;my_field_1&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;my_field_2&quot;</span> <span class="na">string=</span><span class="s">&quot;My Label&quot;</span> <span class="na">widget=</span><span class="s">&quot;statusbar&quot;</span> <span class="na">statusbar_visible=</span><span class="s">&quot;draft,sent,progress,done&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/tree&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p >Odoo supports custom tags acting as syntactic sugar:</p><ul ><li ><p >menuitem: использовать его как ярлык для объявления <code >ir.ui.menu</code></p></li><li ><p >Workflow: тег &lt;workflow&gt; отправляет сигнал в существующий рабочий процесс.</p></li><li ><p >template: использовать его для объявления QWeb View, требующего только раздел <code >arch</code> представления.</p></li><li ><p >report: использовать для объявления <a href="actions.html#reference-actions-report" class="internal reference"><span class="std std-ref">действия отчета</span></a></p></li><li ><p >Act_window: используйте его, если запись записи не может делать то, что вы хотите</p></li></ul><p >4 первых тега предпочтительнее записи * record [UNKNOWN NODE problematic].</p></section><section id="naming-xml-id"><h3 >Формирование имен xml_id</h3></section><section id="security-view-and-action"><h4 >Безопасность, Представление и Действие</h4><p >Используйте следующий шаблон:</p><ul ><li ><p >для меню: <code class="samp"><em >&lt;model_name&gt;</em>_menu</code></p></li><li ><p >Для представления: <code class="samp"><em >&lt;model_name&gt;</em>_view_<em >&lt;view_type&gt;</em></code>, где <em >view_type</em> может быть <code >kanban</code>, <code >form</code>, <code >tree</code>, <code >search</code>, ...</p></li><li ><p >Для действия: основное действие соответствует <code class="samp"><em >&lt;model_name&gt;</em>_action</code>. Остальные имеют суффикс <code class="samp">_<em >&lt;detail&gt;</em></code>, где <em >detail</em> запись прописными буквами поясняющая действие. Суффиксы используются только для тех моделей данных, где есть объявление нескольких действий.</p></li><li ><p >Для группы пользователей: <code class="samp"><em >&lt;model_name&gt;</em>_group_<em >&lt;group_name&gt;</em></code> где <em >group_name</em> является именем группы, как правило 'user', 'manager', ...</p></li><li ><p >Для правила безопасности: <code class="samp"><em >&lt;model_name&gt;</em>_rule_<em >&lt;concerned_group&gt;</em></code> где <em >concerned_group</em> короткое имя соответствующей группы ('user' для 'model_name_group_user', 'public' для неавторизованных пользователей, 'company' для систем с множеством компаний, ...).</p></li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- views and menus --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_view_form&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_view_kanban&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;menuitem</span>
    <span class="na">id=</span><span class="s">&quot;model_name_menu_root&quot;</span>
    <span class="na">name=</span><span class="s">&quot;Main Menu&quot;</span>
    <span class="na">sequence=</span><span class="s">&quot;5&quot;</span>
<span class="nt">/&gt;</span>
<span class="nt">&lt;menuitem</span>
    <span class="na">id=</span><span class="s">&quot;model_name_menu_action&quot;</span>
    <span class="na">name=</span><span class="s">&quot;Sub Menu 1&quot;</span>
    <span class="na">parent=</span><span class="s">&quot;module_name.module_name_menu_root&quot;</span>
    <span class="na">action=</span><span class="s">&quot;model_name_action&quot;</span>
    <span class="na">sequence=</span><span class="s">&quot;10&quot;</span>
<span class="nt">/&gt;</span>

<span class="c">&lt;!-- actions --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_action&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_action_child_list&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="c">&lt;!-- security --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;module_name_group_user&quot;</span> <span class="na">model=</span><span class="s">&quot;res.groups&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_rule_public&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.rule&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_rule_company&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.rule&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Примечание</p><p >Имена представлений используют точечную нотацию <code >my.model.view_type</code> или <code >my.model.view_type.inherit</code> вместо * &quot;This is the form view of My Model&quot; [UNKNOWN NODE problematic].</p></div></section><section id="inherited-xml"><h4 >Унаследованный XML-файл</h4><p >Шаблон для формирования имени расширенного представления <code class="samp"><em >&lt;base_view&gt;</em>_inherit_<em >&lt;current_module_name&gt;</em></code>.Модуль может быть создан исключительно для расширения представления.  Создайте суффикс для оригинального имени <code class="samp">_inherit_<em >&lt;current_module_name&gt;</em></code> где <em >current_module_name</em> техническое имя модуля расширяющего представление.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;inherited_model_view_form_inherit_my_module&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</section><section id="python"><h2 >Python</h2></section><section id="pep8-options"><h3 >Параметры PEP8</h3><p >Использование linter может помочь в подсветке синтаксиса, семантических предупреждений или ошибки. Исходный код Odoo пытается уважать стандарты Python, но некоторые из них можно игнорировать.</p><ul ><li ><p >E501: слишком длинная строка</p></li><li ><p >E301: ожидается 1 пустая строка, найдено 0</p></li><li ><p >E302: ожидается 2 пустые строки, найдено 1</p></li><li ><p >E126: строка продолжается надписью для подвешивания отступа</p></li><li ><p >E123: закрывающая скобка не соответствует отступу строки открывающей скобки</p></li><li ><p >E127: строка заходит за отступ для визуализации отступа</p></li><li ><p >E128: строка продолжения под отступом для визуального отступа</p></li><li ><p >E265: комментарий блока должен начинаться с '#'</p></li></ul></section><section id="imports"><h3 >Импорт</h3><p >Порядок импорта библиотек определен следующим образом:</p><ol ><li ><p >Внешние библиотеки (по одной в строке, отсортированные и разделенные в python stdlib)</p></li><li ><p >Импорт <code >odoo</code></p></li><li ><p >Импорт из модулей Odoo (редко, и только при необходимости)</p></li></ol><p >Внутри этих 3-х групп строки сортируются по алфавиту.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># 1 : imports of python lib</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="c1"># 2 :  imports of odoo</span>
<span class="kn">import</span> <span class="nn">odoo</span>
<span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">api</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">models</span> <span class="c1"># alphabetically ordered</span>
<span class="kn">from</span> <span class="nn">odoo.tools.safe_eval</span> <span class="kn">import</span> <span class="n">safe_eval</span> <span class="k">as</span> <span class="nb">eval</span>
<span class="kn">from</span> <span class="nn">odoo.tools.translate</span> <span class="kn">import</span> <span class="n">_</span>
<span class="c1"># 3 :  imports from odoo modules</span>
<span class="kn">from</span> <span class="nn">odoo.addons.website.models.website</span> <span class="kn">import</span> <span class="n">slug</span>
<span class="kn">from</span> <span class="nn">odoo.addons.web.controllers.main</span> <span class="kn">import</span> <span class="n">login_redirect</span>
</pre></div>
</div>
</section><section id="idiomatics-python-programming"><h3 >Программирование на идиотском языке Python</h3><ul ><li ><p >Каждый файл python должен иметь `` # - * - coding: utf-8 - * - `` в первой строке.</p></li><li ><p >Всегда одобряйте * читаемость * над * краткость * или использование языковых функций или идиом.</p></li><li ><p >Не используйте [UNKNOWN NODE title_reference] `</p></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># bad</span>
<span class="n">new_dict</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">new_list</span> <span class="o">=</span> <span class="n">old_list</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="c1"># good</span>
<span class="n">new_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>
<span class="n">new_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">old_list</span><span class="p">)</span>
</pre></div>
</div>
<ul ><li ><p >Python dictionnary: создание и обновление</p></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># -- creation empty dict</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">my_dict2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="c1"># -- creation with values</span>
<span class="c1"># bad</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="c1"># good</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>

<span class="c1"># -- update dict</span>
<span class="c1"># bad</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># good</span>
<span class="n">my_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">baz</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">my_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">my_dict2</span><span class="p">)</span>
</pre></div>
</div>
<ul ><li ><p >Используйте осмысленные имена переменных/классов/методов</p></li><li ><p >Бесполезная переменная: временные переменные могут сделать код более понятным, указав имена для объектов, но это не означает, что вам нужно постоянно создавать временные переменные:</p></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># pointless</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">]</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">schema</span><span class="p">}</span>
<span class="c1"># simpler</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<ul ><li ><p >Несколько точек возврата в порядке, когда они проще</p></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># a bit complex and with a redundant temp variable</span>
<span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">([]):</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">axes</span>

 <span class="c1"># clearer</span>
<span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">([]):</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="c1"># clone the axis</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="c1"># single-element list</span>
</pre></div>
</div>
<ul ><li ><p >Знайте свои встроенные функции: вы должны по крайней мере иметь общее представление о всех встроенных языках Python (<a href="http://docs.python.org/library/functions.html" class="external reference">http://docs.python.org/library/functions.html</a>)</p></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="c1"># very very redundant</span>
<span class="n">value</span><span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span> <span class="c1"># good</span>
</pre></div>
</div>
<p >Кроме того, `` if 'key' в my_dict`` и `` если my_dict.get ('key') `` имеет совсем другое значение, убедитесь, что используете правильный.</p><ul ><li ><p >Изучение списков: используйте понимание списков, понимание текста и базовые манипуляции с помощью `` map``, `` filter``, [UNKNOWN NODE title_reference], ... Они делают код более легким для чтения.</p></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># not very good</span>
<span class="n">cube</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
<span class="c1"># better</span>
<span class="n">cube</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
</pre></div>
</div>
<ul ><li ><p >Коллекции также булевы: в python многие объекты имеют значение типа «boolean-ish» при оценке в логическом контексте (например, if). Среди них есть коллекции (списки, диктовки, наборы, ...), которые являются «фальшивыми», когда они пусты и «истинны», когда содержат элементы:</p></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nb">bool</span><span class="p">([])</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="nb">bool</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">True</span>
<span class="nb">bool</span><span class="p">([</span><span class="bp">False</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">True</span>
</pre></div>
</div>
<p >Таким образом, вы можете написать `` if some_collection: `` вместо `` if len (some_collection): [UNKNOWN NODE problematic].</p><ul ><li ><p >Итерация по итерируемым элементам</p></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># creates a temporary list and looks bar</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="s2">&quot;do something...&quot;</span>
<span class="c1"># better</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="p">:</span>
        <span class="s2">&quot;do something...&quot;</span>
<span class="c1"># creates a temporary list</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="s2">&quot;do something...&quot;</span>
<span class="c1"># only iterates</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="s2">&quot;do something...&quot;</span>
</pre></div>
</div>
<ul ><li ><p >Использовать dict.setdefault</p></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># longer.. harder to read</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">values</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_value</span><span class="p">)</span>

<span class="c1"># better.. use dict.setdefault method</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
    <span class="n">values</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_value</span><span class="p">)</span>
</pre></div>
</div>
<ul ><li ><p >Как хороший разработчик, документируйте свой код (docstring по методам, простые комментарии для сложной части кода)</p></li><li ><p >В дополнение к этим рекомендациям вы также можете найти следующую ссылку интересную: <a href="http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html" class="external reference">http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html</a> (немного устаревшая, но весьма актуальная)</p></li></ul></section><section id="programming-in-odoo"><h3 >Программирование в Odoo</h3><ul ><li ><p >Избегайте создания генераторов и декораторов: используйте только те, что предусмотрены API Odoo.</p></li><li ><p >Как и в python, используйте методы `` filter``, `` mapped``, [UNKNOWN NODE title_reference], ..., чтобы облегчить чтение кода и производительность.</p></li></ul></section><section id="make-your-method-works-in-batch"><h4 >Сделайте ваш метод работает в пакетном режиме</h4><p >При добавлении функции убедитесь, что она может обрабатывать несколько записей. Как правило, такой метод декорируется декоратором `` api.multi`` (или берет список * id [UNKNOWN NODE problematic], если он написан в старой api). Тогда вам придется перебирать на `` self`` для обработки каждой записи.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api.multi</span>
<span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">record</span><span class="o">.</span><span class="n">do_cool_stuff</span><span class="p">()</span>
</pre></div>
</div>
<p >Избегайте использования декоратора `` api.one``: это, вероятно, не будет работать так, как вы ожидали, и расширение такого метода не так просто, как метод * api.multi [UNKNOWN NODE problematic], поскольку он возвращает список результатов (упорядоченный по набору записей идентификаторы).</p><p >При возникновении проблем с производительностью при разработке кнопки «stat» (например) не выполняйте `` поиск`` или `` search_count`` в цикле в методе `` api.multi``. Рекомендуется использовать метод `` read_group``, чтобы вычислить все значения только в одном запросе.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api.multi</span>
<span class="k">def</span> <span class="nf">_compute_equipment_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot; Count the number of equipement per category &quot;&quot;&quot;</span>
    <span class="n">equipment_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;hr.equipment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read_group</span><span class="p">([(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)],</span> <span class="p">[</span><span class="s1">&#39;category_id&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;category_id&#39;</span><span class="p">])</span>
    <span class="n">mapped_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;category_id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;category_id_count&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">equipment_data</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">category</span><span class="o">.</span><span class="n">equipment_count</span> <span class="o">=</span> <span class="n">mapped_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section><section id="propagate-the-context"><h4 >Распространение контекста</h4><p >В новом API контекст - это `` frozendict``, который нельзя изменить. Чтобы вызвать метод с другим контекстом, следует использовать метод `` with_context``:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">new_context</span><span class="p">)</span><span class="o">.</span><span class="n">do_stuff</span><span class="p">()</span> <span class="c1"># all the context is replaced</span>
<span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="o">**</span><span class="n">additionnal_context</span><span class="p">)</span><span class="o">.</span><span class="n">do_other_stuff</span><span class="p">()</span> <span class="c1"># additionnal_context values override native context ones</span>
</pre></div>
</div>
<p >Параметр передачи в контексте может иметь опасные побочные эффекты. Поскольку значения распространяются автоматически, может появиться некоторое поведение. При вызове метода [UNKNOWN NODE title_reference] модели с ключом * default_my_field * в контексте будет задано значение по умолчанию * my_field * для соответствующей модели. Но если исцелить это создание, будет установлен и другой объект (например, sale.order.line, при создании продажи.порядка) с именем поля * my_field [UNKNOWN NODE problematic], значение по умолчанию.</p><p >Если вам нужно создать ключевой контекст, влияющий на поведение какого-либо объекта, выберите хорошее имя и в конечном итоге префикс его именем модуля, чтобы изолировать его воздействие. Хорошим примером являются ключи модуля `` mail``: * mail_create_nosubscribe [UNKNOWN NODE problematic], * mail_notrack [UNKNOWN NODE problematic], * mail_notify_user_signature [UNKNOWN NODE problematic], ...</p></section><section id="do-not-bypass-the-orm"><h4 >Не обходите ORM</h4><p >Вы никогда не должны использовать курсор базы данных напрямую, когда ORM может сделать то же самое! Поступая таким образом, вы обходите все функции ORM, возможно, транзакции, права доступа и т. Д.</p><p >И, скорее всего, вы также делаете код более трудным для чтения и, вероятно, менее безопасным.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># very very wrong</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM auction_lots WHERE auction_id in (&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ids</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;) AND state=</span><span class="si">%s</span><span class="s1"> AND obj_price &gt; 0&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;draft&#39;</span><span class="p">,))</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

<span class="c1"># no injection, but still wrong</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM auction_lots WHERE auction_id in </span><span class="si">%s</span><span class="s1"> &#39;</span>\
           <span class="s1">&#39;AND state=</span><span class="si">%s</span><span class="s1"> AND obj_price &gt; 0&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">),</span> <span class="s1">&#39;draft&#39;</span><span class="p">,))</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

<span class="c1"># better</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;auction_id&#39;</span><span class="p">,</span><span class="s1">&#39;in&#39;</span><span class="p">,</span><span class="n">ids</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;draft&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;obj_price&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)])</span>
</pre></div>
</div>
</section><section id="no-sql-injections-please"><h4 >Никаких инъекций SQL, пожалуйста!</h4><p >Следует проявлять осторожность, чтобы не вводить уязвимости SQL-инъекций при использовании запросов SQL вручную. Уязвимость присутствует, когда пользовательский ввод либо неправильно фильтруется, либо плохо цитируется, что позволяет злоумышленнику вводить нежелательные предложения в SQL-запрос (например, обходить фильтры или выполнять команды UPDATE или DELETE).</p><p >Лучший способ быть безопасным - никогда, НИКОГДА не использовать интерполяцию строковых констант (+) или строковых параметров Python (%) для передачи переменных в строку запроса SQL.</p><p >Вторая причина, которая почти столь же важна, заключается в том, что задание уровня абстракции базы данных (psycopg2) должно решить, как форматировать параметры запроса, а не вашу работу! Например, psycopg2 знает, что когда вы передаете список значений, он должен отформатировать их как список, разделенный запятыми, заключенный в круглые скобки!</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># the following is very bad:</span>
<span class="c1">#   - it&#39;s a SQL injection vulnerability</span>
<span class="c1">#   - it&#39;s unreadable</span>
<span class="c1">#   - it&#39;s not your job to format the list of ids</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT distinct child_id FROM account_account_consol_rel &#39;</span> <span class="o">+</span>
           <span class="s1">&#39;WHERE parent_id IN (&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ids</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

<span class="c1"># better</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT DISTINCT child_id &#39;</span>\
           <span class="s1">&#39;FROM account_account_consol_rel &#39;</span>\
           <span class="s1">&#39;WHERE parent_id IN </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
           <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">),))</span>
</pre></div>
</div>
<p >Это очень важно, поэтому будьте внимательны и при рефакторинге, и, самое главное, не копируйте эти шаблоны!</p><p >Вот незабываемый пример, который поможет вам вспомнить, в чем проблема (но не копируйте код там). Прежде чем продолжить, обязательно прочтите онлайн-документацию pyscopg2, чтобы узнать, как правильно ее использовать:</p><ul ><li ><p >Проблема с параметрами запроса (<a href="http://initd.org/psycopg/docs/usage.html#the-problem-with-the-query-parameters" class="external reference">http://initd.org/psycopg/docs/usage.html#the-problem-with-the-query-parameters</a>)</p></li><li ><p >Как передавать параметры с помощью psycopg2 (<a href="http://initd.org/psycopg/docs/usage.html#passing-parameters-to-sql-queries" class="external reference">http://initd.org/psycopg/docs/usage.html#passing-parameters-to-sql-queries</a>)</p></li><li ><p >Расширенные типы параметров (<a href="http://initd.org/psycopg/docs/usage.html#adaptation-of-python-values-to-sql-types" class="external reference">http://initd.org/psycopg/docs/usage.html#adaptation-of-python-values-to-sql-types</a>)</p></li></ul></section><section id="keep-your-methods-short-simple-when-possible"><h4 >Держите свои методы короткими / простыми, когда это возможно</h4><p >Функции и методы не должны содержать слишком много логики: иметь много маленьких и простых методов более целесообразно, чем иметь несколько больших и сложных методов. Хорошее эмпирическое правило состоит в том, чтобы разбить метод, как только: - он имеет более одной ответственности (см. <a href="Http://en.wikipedia.org/wiki/Single_responsibility_principle" class="external reference">Http://en.wikipedia.org/wiki/Single_responsibility_principle</a>) - он слишком велик, чтобы уместиться на одном экране.</p><p >Кроме того, назовите свои функции соответственно: маленькие и правильно названные функции являются отправной точкой кода для чтения / сопровождения и более жесткой документации.</p><p >Эта рекомендация также относится к классам, файлам, модулям и пакетам. (См. Также <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity" class="external reference">http://en.wikipedia.org/wiki/Cyclomatic_complexity</a>)</p></section><section id="never-commit-the-transaction"><h4 >Никогда не совершать транзакции</h4><p >Структура Odoo отвечает за обеспечение транзакционного контекста для всех вызовов RPC. Принцип состоит в том, что новый курсор базы данных открывается в начале каждого вызова RPC и фиксируется, когда вызов возвращается, непосредственно перед передачей ответа клиенту RPC примерно так:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_name</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">db</span><span class="p">,</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">pooler</span><span class="o">.</span><span class="n">get_db_and_pool</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
    <span class="c1"># create transaction cursor</span>
    <span class="n">cr</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">execute_cr</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span> <span class="c1"># all good, we commit</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span> <span class="c1"># error, rollback everything atomically</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># always close cursor opened manually</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p >Если во время выполнения вызова RPC возникает какая-либо ошибка, транзакция откатывается атомарно, сохраняя состояние системы.</p><p >Аналогичным образом, система также предоставляет выделенную транзакцию во время выполнения наборов тестов, поэтому ее можно отменить или отменить в зависимости от параметров запуска сервера.</p><p >Следствием этого является то, что, когда вы вручную вызываете `` cr.commit () `` где угодно, очень высока вероятность разрыва системы по-разному, потому что вы будете совершать частичные коммиты и, следовательно, частичные и нечистые откаты, вызывая среди другие:</p><ol ><li ><p >Несогласованные бизнес-данные, обычно потеря данных</p></li><li ><p >Автоматическая десинхронизация рабочего процесса, постоянно застрявшие документы</p></li><li ><p >Тесты, которые нельзя отменить чисто, и начнут загрязнять базу данных, и инициируют ошибку (это верно, даже если во время транзакции не возникла ошибка)</p></li></ol><dl ><dt >Вот самое простое правило:</dt><dd ><p >Вы должны ** НИКОГДА ** не называть `` cr.commit () `` сами, ** UNLESS [UNKNOWN NODE problematic], вы явно создали свой собственный курсор базы данных! И ситуации, когда вам нужно это делать, являются исключительными!</p><p >И, кстати, если вы создали свой собственный курсор, вам нужно обрабатывать случаи ошибок и правильный откат, а также правильно закрывать курсор, когда вы закончите с ним.</p></dd></dl><p >И вопреки распространенному мнению, вам даже не нужно вызывать [UNKNOWN NODE title_reference] [UNKNOWN NODE title_reference] [UNKNOWN NODE title_reference] объекта * models.Model [UNKNOWN NODE problematic]: это сделано Уход с помощью метода инициализации аддонов или транзакция ORM при создании пользовательских моделей - в отчетах: `` commit () `` обрабатывается инфраструктурой, так что вы можете обновлять базу данных даже изнутри отчета - в пределах * Models.Transient [UNKNOWN NODE problematic]: эти методы называются точно так же, как и обычные * модели. Моделей [UNKNOWN NODE problematic], внутри транзакции и с соответствующим `` cr.commit () / rollback () `` в конце - и т. Д. (См. Общее правило Выше, если у вас есть сомнения!)</p><p >Начиная с этого момента все вызовы `` cr.commit () `` вне рамок сервера должны иметь ** явный комментарий [UNKNOWN NODE problematic], объясняющий, почему они абсолютно необходимы, почему они действительно правильны и почему они не нарушают транзакции. В противном случае их можно и удалять!</p></section><section id="use-translation-method-correctly"><h4 >Правильно используйте метод перевода</h4><p >В Odoo используется похожий на GetText метод под названием &quot;underscore&quot; <code >_()</code>, чтобы указать, что статическая строка, используемая в коде, должна быть переведена во время выполнения, используя язык контекста. Этот псевдо-метод доступен в вашем коде путем импорта следующим образом:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo.tools.translate</span> <span class="kn">import</span> <span class="n">_</span>
</pre></div>
</div>
<p >Необходимо соблюдать несколько очень важных правил при его использовании, чтобы оно работало и чтобы избежать заполнения переводов бесполезным хламом.</p><p >В принципе, этот метод следует использовать только для статических строк, написанных вручную в коде, он не будет работать для перевода значений полей, таких как имена продуктов и т. Д. Это должно быть сделано вместо этого с использованием флага перевода в соответствующем поле.</p><p >Правило очень просто: вызовы метода подчёркивания всегда должны быть в форме [UNKNOWN NODE title_reference] [UNKNOWN NODE problematic]и ничего больше:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># good: plain strings</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;This record is locked!&#39;</span><span class="p">)</span>

<span class="c1"># good: strings with formatting patterns included</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Record </span><span class="si">%s</span><span class="s1"> cannot be modified!&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">record</span>

<span class="c1"># ok too: multi-line literal strings</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;This is a bad multiline example</span>
<span class="s2">             about record </span><span class="si">%s</span><span class="s2">!&quot;&quot;&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">record</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Record </span><span class="si">%s</span><span class="s1"> cannot be modified&#39;</span> \
          <span class="s1">&#39;after being validated!&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">record</span>

<span class="c1"># bad: tries to translate after string formatting</span>
<span class="c1">#      (pay attention to brackets!)</span>
<span class="c1"># This does NOT work and messes up the translations!</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Record </span><span class="si">%s</span><span class="s1"> cannot be modified!&#39;</span> <span class="o">%</span> <span class="n">record</span><span class="p">)</span>

<span class="c1"># bad: dynamic string, string concatenation, etc are forbidden!</span>
<span class="c1"># This does NOT work and messes up the translations!</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">que_rec</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># bad: field values are automatically translated by the framework</span>
<span class="c1"># This is useless and will not work the way you think:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is out of stock!&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">_</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># and the following will of course not work as already explained:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is out of stock!&quot;</span> <span class="o">%</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># bad: field values are automatically translated by the framework</span>
<span class="c1"># This is useless and will not work the way you think:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is not available!&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">_</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># and the following will of course not work as already explained:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is not available!&quot;</span> <span class="o">%</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># Instead you can do the following and everything will be translated,</span>
<span class="c1"># including the product name if its field definition has the</span>
<span class="c1"># translate flag properly set:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is not available!&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p >Кроме того, имейте в виду, что переводчикам придется работать с литеральными значениями, которые передаются функции подчеркивания, поэтому попробуйте сделать их легкими для понимания и свести паразитные символы и форматирование к минимуму. Переводчики должны знать, что шаблоны форматирования, такие как %s или %d , переводы строк и т. Д. Должны быть сохранены, но важно использовать их разумным и очевидным образом:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Bad: makes the translations hard to work with</span>
<span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">question</span> <span class="o">+</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;&#39; </span><span class="se">\n</span><span class="s2">Please enter an integer value &quot;</span><span class="p">)</span>

<span class="c1"># Better (pay attention to position of the brackets too!)</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Answer to question </span><span class="si">%s</span><span class="s2"> is not valid.</span><span class="se">\n</span><span class="s2">&quot;</span> \
          <span class="s2">&quot;Please enter an integer value.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">question</span>
</pre></div>
</div>
<p >Вообще в Odoo, когда манипулируют строками, предпочитаете <code >% `` over</code> .format () `` (когда только одна переменная заменяется в строке), и предпочитаете [UNKNOWN NODE problematic]% (varname) `` вместо position ( Когда необходимо заменить несколько переменных). Это облегчает перевод переводчикам сообщества.</p></section><section id="symbols-and-conventions"><h3 >Символы и обозначения</h3><ul ><li ><dl ><dt >Название модели (с использованием точечной нотации, префикс по имени модуля):</dt><dd ><ul ><li ><p >При определении Оду-модели: используйте единственную форму имени (* res.partner * и * sale.order * вместо * res.partnerS * и * saleS.orderS [UNKNOWN NODE problematic])</p></li><li ><p >При определении переходника Odoo (wizard): используйте `` &lt;related_base_model&gt;. &lt;Action&gt; `` where * related_base_model * - базовая модель (определенная в * models / [UNKNOWN NODE problematic]), относящаяся к переходному процессу, а * action * - это короткое имя Того, что делает переходный процесс. Например: `` account.invoice.make``, `` project.task.delegate.batch``, ...</p></li><li ><p >При определении * report * model (SQL views ei): используйте `` &lt;related_base_model&gt; .report. &lt;Action&gt; [UNKNOWN NODE problematic], исходя из соглашения Transient.</p></li></ul></dd></dl></li><li ><p >Класс Odoo Python: используйте camelcase для кода в api v8 (Object-oriented style), подчеркивайте нижний регистр нотации для старой api (стиль SQL).</p></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountInvoice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">account_invoice</span><span class="p">(</span><span class="n">osv</span><span class="o">.</span><span class="n">osv</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<ul ><li ><dl ><dt >Имя переменной:</dt><dd ><ul ><li ><p >Используйте camelcase при определении переменных в модели данных</p></li><li ><p >Используйте нижний регистр и подчеркивание при определении обычных переменных.</p></li><li ><p >Так как новый API работает с записью или набором записей вместо списка идентификаторов, не нужно добавлять имя переменной с <em >_id</em> или <em >_ids</em>, если они не содержат id или список id.</p></li></ul></dd></dl></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ResPartner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
<span class="n">partners</span> <span class="o">=</span> <span class="n">ResPartner</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
<span class="n">partner_id</span> <span class="o">=</span> <span class="n">partners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<ul ><li ><p >Поля <code >One2Many</code> и <code >Many2Many</code> всегда должны иметь * _ids * в качестве суффикса (например: sale_order_line_ids)</p></li><li ><p >Поля <code >Many2One</code> должны иметь <em >_id</em> в качестве суффикса (пример: partner_id, user_id, ...)</p></li><li ><dl ><dt >Соглашения о методах</dt><dd ><ul ><li ><p >Compute Field : шаблон метода расчета <em >_compute_&lt;имя_поля&gt;</em></p></li><li ><p >Search method: шаблон метода поиска <em >_search_&lt;field_name&gt;</em></p></li><li ><p >Default method: шаблон метода по умолчанию <em >_default_&lt;field_name&gt;</em></p></li><li ><p >Onchange method: шаблон метода onchange <em >_onchange_&lt;field_name&gt;</em></p></li><li ><p >Constraint method : шаблон метода ограничения <em >_check_&lt;constraint_name&gt;</em></p></li><li ><p >Action method : начинается с префикса <em >action_</em>. Его декоратор <code >@api.multi</code>, но когда используется только одна запись добавьте в начале метода <code >self.ensure_one()</code>.</p></li></ul></dd></dl></li><li ><dl ><dt >В атрибутах модели данных порядок должен быть следующим</dt><dd ><ol ><li ><p >Частные атрибуты (<code >_name</code>, <code >_description</code>, <code >_inherit</code>, ...)</p></li><li ><p >Метод по умолчанию и <code >_default_get</code></p></li><li ><p >Объявления полей</p></li><li ><p >Методы поиска и вычисления. Они должны идти в том же порядке, что и объявление поля</p></li><li ><p >Методы ограничений (<code >@api.constrains</code>) и onchange методы (<code >@api.onchange</code>)</p></li><li ><p >Методы CRUD (переопределения ORM)</p></li><li ><p >Методы действий</p></li><li ><p >И, наконец, другие методы, описывающие бизнес-логику.</p></li></ol></dd></dl></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># Private attributes</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;event.event&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Event&#39;</span>

    <span class="c1"># Default methods</span>
    <span class="k">def</span> <span class="nf">_default_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># Fields declaration</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_name</span><span class="p">)</span>
    <span class="n">seats_reserved</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">oldname</span><span class="o">=</span><span class="s1">&#39;register_current&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Reserved Seats&#39;</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_seats&#39;</span><span class="p">)</span>
    <span class="n">seats_available</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">oldname</span><span class="o">=</span><span class="s1">&#39;register_avail&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Available Seats&#39;</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_seats&#39;</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>

    <span class="c1"># compute and search fields, in the same order of fields declaration</span>
    <span class="nd">@api.multi</span>
    <span class="nd">@api.depends</span><span class="p">(</span><span class="s1">&#39;seats_max&#39;</span><span class="p">,</span> <span class="s1">&#39;registration_ids.state&#39;</span><span class="p">,</span> <span class="s1">&#39;registration_ids.nb_register&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># Constraints and onchanges</span>
    <span class="nd">@api.constrains</span><span class="p">(</span><span class="s1">&#39;seats_max&#39;</span><span class="p">,</span> <span class="s1">&#39;seats_available&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_seats_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@api.onchange</span><span class="p">(</span><span class="s1">&#39;date_begin&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_date_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># CRUD methods (and name_get, name_search, ...) overrides</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># Action methods</span>
    <span class="nd">@api.multi</span>
    <span class="k">def</span> <span class="nf">action_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_one</span><span class="p">()</span>
        <span class="o">...</span>

    <span class="c1"># Business methods</span>
    <span class="k">def</span> <span class="nf">mail_user_confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
</section><section id="javascript-and-css"><h2 >Javascript и CSS</h2><p ><strong >Для javascript :</strong></p><ul ><li ><p ><code >use strict;</code> рекомендуется во всех файлах javascript</p></li><li ><p >Используйте linter (jshint, ...)</p></li><li ><p >Никогда не добавляйте минифицированные библиотеки Javascript</p></li><li ><p >Используйте camelcase для объявления класса</p></li><li ><p >Если ваш код не должен запускаться на каждой странице, укажите целевые страницы с помощью функции <code >if_dom_contains</code> модуля сайта. Нацельте элемент, который является специфическим для страниц, которые ваш код должен запускать с использованием JQuery.</p></li></ul><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">openerp</span><span class="p">.</span><span class="nx">website</span><span class="p">.</span><span class="nx">if_dom_contains</span><span class="p">(</span><span class="s1">&#39;.jquery_class_selector&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="cm">/*your code here*/</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><strong >Для CSS :</strong></p><ul ><li ><p >Префикс всех ваших классов с <em >o_&lt;module_name&gt;</em> где <em >module_name</em> - техническое имя модуля ('sale', 'im_chat', ...) или основной маршрут, зарезервированный модулем (для модуля сайта главным образом, т.е. : 'o_forum' для модуля <em >website_forum</em>). Единственным исключением для этого правила является webclient: он просто использует префикс <em >o_</em>.</p></li><li ><p >Избегайте использования id</p></li><li ><p >Использовать собственные классы Bootstrap</p></li><li ><p >Используйте нижний регистр для обозначения класса</p></li></ul></section><section id="git"><h2 >Git</h2></section><section id="commit-message"><h3 >Коммиты</h3><p >Префикс для вашего коммита</p><ul ><li ><p ><strong >[IMP]</strong> для улучшения (improvement)</p></li><li ><p ><strong >[FIX]</strong> для исправления ошибок</p></li><li ><p ><strong >[REF]</strong> для рефакторинга</p></li><li ><p ><strong >[ADD]</strong> для добавления новых ресурсов</p></li><li ><p ><strong >[REM]</strong> для удаления ресурсов</p></li><li ><p ><strong >[MOV]</strong> для перемещения файлов (не меняйте содержимое перемещенного файла, иначе Git потеряет дорожку, а история будет потеряна!), Или просто переместите код из файла в другой.</p></li><li ><p ><strong >[MERGE]</strong> для merge коммитов (только для прямого/обратного портирования)</p></li><li ><p ><strong >[CLA]</strong> для подписи индивидуальной авторской лицензии Odoo</p></li></ul><p >Затем в теле сообщении укажите часть кода, на которую повлияли ваши изменения (имя модуля, библиотека, transversal объект, ...) и описание изменений.</p><ul ><li ><p >Всегда делайте коммит информативным: он должно быть самодостаточным, включать имя модуля, который был изменен, и причину изменения. Не используйте одиночные слова, такие как «исправление» или «улучшения».</p></li><li ><p >Избегайте коммитов, которые одновременно воздействуют на несколько модулей. Попытайтесь их разделить таким образом чтобы модули были независимы друг от друга (будет полезно, если нам нужно будет откатить модуль отдельно).</p></li></ul><div class="highlight-text"><div class="highlight"><pre><span></span>[FIX] website, website_mail: remove unused alert div, fixes look of input-group-btn

Bootstrap&#39;s CSS depends on the input-group-btn
element being the first/last child of its parent.
This was not the case because of the invisible
and useless alert.

[IMP] fields: reduce memory footprint of list/set field attributes

[REF] web: add module system to the web client

This commit introduces a new module system for the javascript code.
Instead of using global ...
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Примечание</p><p >Используйте длинное описание, чтобы объяснить <em >почему</em> а не <em >что</em>, <em >что</em> и так можно увидеть в diff</p></div></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
    </div>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
  <footer class="o_footer_effect">
            <div id="footer" class="container o_not_editable">
                <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
                <div class="row">
                    <div class="col-xs-12">
                        <hr>
						<p>Перевод документации при поддержке <a href="https://www.yartsev.by/" target="_blank">Ярцев и компаньоны</a> и <a href="https://www.udelta.ru" target="_blank">Udelta</a></p>
                        <hr>
                        <p>
                            <small>Odoo - это набор бизнес-приложений с открытым исходным кодом, которые охватывают все потребности вашей компании: CRM, интернет магазин, бухгалтерский учет, складской учет, POS терминал, управление проектами и т.д. <br> <br>
В то же время полноценное внедрение Odoo может быть очень простым и включать полную интеграцию с вашим предприятием.</small>
                        </p>
                    </div>
                </div>
            </div>

            <div class="o_footer_bottom o_not_editable">
                <div class="container">
                    <a class="small" href="https://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
                    <div class="social-links pull-right">
                        <a href="https://www.odoo.com/web/about/facebook">
                            <i class="fa fa-facebook"></i>
                        </a>
                        <a href="https://www.odoo.com/web/about/twitter">
                            <i class="fa fa-twitter"></i>
                        </a>
                        <a href="https://www.odoo.com/web/about/linkedin">
                            <i class="fa fa-linkedin"></i>
                        </a>
                        <a href="mailto:info@odoo.com">
                            <i class="fa fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>
        </footer><!-- Yandex.Metrika counter --> <script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter44508703 = new Ya.Metrika({ id:44508703, clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks"); </script> <noscript><div><img src="https://mc.yandex.ru/watch/44508703" style="position:absolute; left:-9999px;" alt="" /></div></noscript> <!-- /Yandex.Metrika counter -->
  </body>
</html>